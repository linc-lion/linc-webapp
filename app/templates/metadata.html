<!-- LINC is an open source shared database and facial recognition
system that allows for collaboration in wildlife monitoring.
Copyright (C) 2016  Wildlifeguardians

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

For more information or to contact visit linclion.org or email tech@linclion.org -->
<script type="text/ng-template" id="Warning.tmpl.html">
  <div class="modal-header" ng-show="modalTitle">
    <h4 class="modal-title" ng-bind-html="modalTitle"></h4>
  </div>
  <div class="modal-body" ng-bind-html="modalMessage">
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button>
    <button type="button" class="btn btn-primary" ng-click="ok()">OK</button>
  </div>
</script>
<form name="metadataForm">
  <div class="modal-header" ng-show="title">
    <button type="button" class="close" ng-click="Cancel()">&times;</button>
    <h3 class="modal-title" ng-bind-html="title"></h3>
  </div>
  <div class="modal-body" ng-show="content">
    <div class="row">
      <div class="col-sm-8 line-right">
        <div class="row">
          <div class="col-sm-6 line-right">
            <div ng-show="optionsSet.type === 'imageset'" class="form-inline group-select"  ng-class="{'has-error': metadataForm.owner_organization_id.$dirty && metadataForm.owner_organization_id.$error.required }">
              <label class="meta_label" for="owner_organization_id">Organization:</label>
              <select class="form-control custom-select" name="owner_organization_id" ng-options="organization.id as organization.name for organization in organizations" ng-model="selected.owner_organization_id" ng-disabled="!Editable" oninvalid="this.setCustomValidity('Please select an Organization in this list')" oninput="setCustomValidity('')" ng-change="ChangeWarning($event);" required><option value="">Select Organization</option>
              </select>
            </div>
            <pre ng-show="debug">{{!selected.owner_organization_id}}</pre>

            <div ng-show="optionsSet.type === 'lion'" class="form-inline group-select"  ng-class="{'has-error': metadataForm.organization_id.$dirty && metadataForm.organization_id.$error.required }">
              <label class="meta_label" for="organization_id">Organization:</label>
              <select class="form-control custom-select" name="organization_id" ng-options="organization.id as organization.name for organization in organizations" ng-model="selected.organization_id" ng-required="lion_required" ng-disabled="!Editable" oninvalid="this.setCustomValidity('Please select an Organization in this list')" oninput="setCustomValidity('')" ng-change="ChangeWarning($event);"><option value="">Select Organization</option>
              </select>
            </div>
            <pre ng-show="debug">{{!selected.organization_id}}</pre>

            <hr class="style-line">
            <div class="form-inline group-input" ng-class="{'has-error': datepickerForm.date.$invalid}">
              <label class="control-label meta_label"><i class="fa fa-calendar"></i>Date Stamp: </label>
              <input type="text" class="form-control meta_input" ng-model="selected.date_stamp" data-date-format="yyyy-MM-dd" data-date-type="date" data-min-date="02/10/86" data-max-date="today" data-autoclose="1" name="date" bs-datepicker placement="bottom-left">
            </div>
            <pre ng-show="debug">{{!selected.date_stamp}}</pre>
            <hr class="style-line">

            <div class="form-group group-input">
              <div class="form-inline">
                <div class="form-group control div-width-100" ng-class="{'has-error': metadataForm.latitude.$dirty && (metadataForm.latitude.$error.pattern || metadataForm.latitude.$error.limlatlng)}">
                  <label class="meta_label" for="latitude">Latitude: </label>
                  <input class="form-control meta_input" type="text" pattern="^[+-]?[0-9]+([\.|,][0-9]{1,20})?" ng-model="selected.latitude" name="latitude" oninvalid="this.setCustomValidity('Please enter a valid latitude number')" oninput="setCustomValidity('')" limlatlng="90">
                  <span class="icon icon-cross" ng-click="submitted=false;" ng-show="metadataForm.latitude.$error.limlatlng && submitted"></span>
                  <div class="error-messages" ng-messages="metadataForm.latitude.$error" ng-if="submitted">
                    <div ng-message="limlatlng">
                      <div class="row">
                        <div class="col-sm-2">
                          <i class="icon icon-error icon-notification"></i>
                        </div>
                        <div class="col-sm-10 error-msg-col">
                          choose a latitude value between -90 and 90.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-inline">
                <div class="form-group control div-width-100" ng-class="{'has-error': metadataForm.longitude.$dirty && (metadataForm.longitude.$error.pattern || metadataForm.longitude.$error.limlatlng)}">
                  <label class="meta_label" for="longitude">Longitude: </label>
                  <input class="form-control meta_input" type="text" pattern="^[+-]?[0-9]+([\.|,][0-9]{1,20})?" ng-model="selected.longitude" name="longitude" oninvalid="this.setCustomValidity('Please enter a valid longitude number')" oninput="setCustomValidity('')" limlatlng="180">
                  <span class="icon icon-cross" ng-click="submitted=false;" ng-show="!metadataForm.latitude.$error.limlatlng && metadataForm.longitude.$error.limlatlng && submitted"></span>
                  <div class="error-messages" ng-messages="metadataForm.longitude.$error" ng-if="!metadataForm.latitude.$error.limlatlng && submitted">
                    <div ng-message="limlatlng">
                      <div class="row">
                        <div class="col-sm-2">
                          <i class="icon icon-error icon-notification"></i>
                        </div>
                        <div class="col-sm-10 error-msg-col">
                          choose a longitude value between -180 and 180.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <pre ng-show="debug">{{!selected.latitude}} {{!selected.longitude}}</pre>
          </div>
          <div class="col-sm-6">
            <div ng-show="isLion">
              <div class="form-inline group-input" ng-class="{'has-error': metadataForm.lion_name.$dirty && metadataForm.lion_name.$error.required }">
                <label class="meta_label" for="lion_name">Lion Name:</label>
                <input type="text" class="form-control meta_input" name="lion_name" ng-model="selected.name" placeholder="Lion Name" ng-required="lion_required" oninput="setCustomValidity('')"
                oninvalid="this.setCustomValidity('please fill out this field with Lion\'s Name')">
                <label ng-show="!isNew"><small>(id: {{!selected.id}})</small></label>
              </div>
            </div>
            <div ng-show="!isLion">
              <div ng-show="!isNew">
                <div ng-if="selected.lion_id !== null" class="form-inline group-input-center">
                  <label class="meta_label" for="lion_name2">Lion: </label>
                  <a ui-sref="lion({id: selected.lion_id})" target="_blank" name="lion_name2" data-animation="am-flip-x" placement="bottom-right" bs-tooltip="tooltip">{{!selected.lion_id}}-{{!selected.name}}</a>
                </div>
                <div ng-if="selected.lion_id === null">
                  <div ng-if="select_new_lion.show" class="form-group group-input">
                    <label class="meta_label" for="lion_name">Lion:</label>
                    <ui-select class="lion-ui-select" ng-model="new_lion.selected" theme="bootstrap">
                      <ui-select-match placeholder="Select a Lion...">
                        <span ng-bind="$select.selected.label"></span>
                      </ui-select-match>
                      <ui-select-choices repeat="item in (ListLions | filter: $select.search) track by item.index">
                        <span ng-bind="item.label"></span>
                      </ui-select-choices>
                    </ui-select>
                  </div>
                  <div ng-if="!select_new_lion.show" class="form-group group-select">
                    <label class="meta_label" for="lion_name1" >Lion: - </label>
                    <button class="btn btn-default btn-sm select_btn select_btn_1" ng-click="set_select(true)"> {{!select_new_lion.label}} </button>
                  </div>
                </div>
              </div>
              <pre ng-show="debug">{{!selected.name}}</pre>
            </div>
            <hr ng-show="showLionName" class="style-line">

            <div class="form-inline group-input" ng-class="{'has-error': datepickerForm.date1.$invalid}">
              <label class="control-label"><i class="fa fa-calendar"></i>Date of Birth: </label>
              <input type="text" class="form-control meta_input" ng-model="selected.date_of_birth" ng-change='Calc_Age()' data-date-format="yyyy-MM-dd" data-date-type="date" data-max-date="today" data-autoclose="1" name="date1" bs-datepicker placement="bottom-right">
            </div>
            <pre ng-show="debug">{{!selected.date_of_birth}}</pre>

            <div class="form-inline group-input-center">
              <label for="id_age">Age: {{!lion_age}} <small>(years)</small></label>
            </div>
            <pre ng-show="debug">{{!lion_age}}</pre>

            <hr class="style-line">

            <div class="form-group group-select">
              <label class="meta_label" for="id_gender" >Gender:</label>
              <button type="button" id="id_gender" placeholder="Select Gender" class="btn btn-default btn-sm select_btn" ng-model="selected.gender" data-html="1" bs-options="gen.value as gen.label for gen in genders" placement="bottom-right" bs-select>
                Action <span class="caret"></span>
              </button>
            </div>

            <pre ng-show="debug">{{!selected.gender}}</pre>
          </div>
        </div>
        <div>
          <hr class="style-line">
          <div class="form-group">
            <textarea class="form-control" rows="5" ng-model="selected.notes" placeholder="Notes here" ></textarea>
          </div>
          <pre ng-show="debug">{{!selected.notes}}</pre>
        </div>
<!--tmp-->
        <div>
          <div class="checkbox">
            <label class="checkbox-inline">
              <input type="checkbox" class="form-input" ng-model="selected.isPrivate.gps">GPS Points is Private
            </label>
          </div>
          <div class="checkbox">
            <label class="checkbox-inline">
              <input type="checkbox" class="form-input" ng-model="selected.isPrivate.map">Map Location is Private
            </label>
          </div>
          <div class="checkbox">
            <label class="checkbox-inline">
              <input type="checkbox" ng-disabled="!isLion" class="form-input" ng-model="selected.isDead">Dead Lion
            </label>
          </div>
        </div>
<!--tmp-->
      </div>
      <div class="col-sm-4">
        <div class="form-group group-select" ng-repeat="marking in markings">
          <label for="id_{{!marking.value}}" >{{!marking.label}} Markings: </label>
          <button type="button" id="id_{{!marking.value}}" placeholder="None" class="btn btn-default btn-sm select_btn" ng-model="selected.markings[marking.value]" data-html="1" data-multiple="1" all-none-buttons="true" all-Text="{{!marking.allText}}" bs-options="mark.value as mark.label for mark in marking.items" placement="bottom-right" bs-select>
            Action <span class="caret"></span>
          </button>
          <pre ng-show="debug">{{!selected.markings[marking.value]}}</pre>
        </div>

        <hr class="style-line">
        <div class="form-group group-select">
          <label for="id_nose_color">Nose Color: </label>
          <button type="button" id="id_nose_color" placeholder="None" class="btn btn-default btn-sm select_btn" ng-model="selected.nose_color" data-html="1" bs-options="color.value as color.label for color in nose_color" placement="bottom-right" bs-select>
            Action <span class="caret"></span>
          </button>
        </div>
        <pre ng-show="debug">{{!selected.nose_color}}</pre>

        <hr class="style-line">
        <div class="form-group group-select">
          <label for="id_scars">Scars: </label>
          <button type="button" id="id_scars" placeholder="None" class="btn btn-default btn-sm select_btn" ng-model="selected.scars" data-html="1" data-multiple="1" all-none-buttons="true" all-Text="All Scars Type" bs-options="scar.value as scar.label for scar in scars" placement="bottom-right" bs-select>
            Action <span class="caret"></span>
          </button>
        </div>
        <pre ng-show="debug">{{!selected.scars}}</pre>

        <hr class="style-line">
        <div class="form-group group-select">
<!--tmp-->
          <label for="id_eye_damage">Eye Damage / Pigmentation: </label>
          <button type="button" id="id_eye_damage" placeholder="None" class="btn btn-default btn-sm select_btn" ng-model="selected.eye_damage" data-html="1" data-multiple="1" all-none-buttons="true" all-Text="All Eye Damage" bs-options="damage.value as damage.label for damage in eye_damage" placement="bottom-right" bs-select>
            Action <span class="caret"></span>
          </button>
        </div>
        <pre ng-show="debug">{{!selected.eye_damage}}</pre>

        <hr class="style-line">
        <div class="form-group group-select">
          <label for="id_broken_teeth">Broken Teeth: </label>
          <button type="button" id="id_broken_teeth" placeholder="None" class="btn btn-default btn-sm select_btn" ng-model="selected.broken_teeth" data-html="1" data-multiple="1" all-none-buttons="true" all-Text="All Broken Teeth" bs-options="teeth.value as teeth.label for teeth in broken_teeth" placement="bottom-right" bs-select>
            Action <span class="caret"></span>
          </button>
        </div>
        <pre ng-show="debug">{{!selected.broken_teeth}}</pre>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <!--<button type="button" class="btn btn-default" ng-click="Cancel()">Close</button>-->

    <button ng-disabled="!metadataForm.modified" ng-show="!isNew" type="submit" class="btn btn-primary" ng-click="submit(metadataForm) && metadataForm.$valid && SaveMetadata()">Save</button>

    <button ng-show="isNew" type="submit" class="btn btn-primary" ng-click="submit(metadataForm) &&  metadataForm.$valid && CreateClose()">Create</button>

    <upload-images btn-submit="submit(metadataForm)" ng-show="isNew" use-ctrl="UploadImagesCtrl" use-template-url="uploadimages.html" form-size="lg" type="new" save-metadata-action="CreateUpload()" close-action="Close()" debug="debug"></upload-images>

    <br>
  </div>
</form>
