<!-- LINC is an open source shared database and facial recognition
system that allows for collaboration in wildlife monitoring.
Copyright (C) 2016  Wildlifeguardians

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

For more information or to contact visit linclion.org or email tech@linclion.org -->
<div name="SearchImageSet" class="font-homenaje">
  <button type="button" class="btn-help pull-right btn btn-icon" data-placement="left" title="" data-content="Search image sets to view summaries of name, age, organization, and CV status. Select a search result row to view an image set's primary image, to create a lion from an image set, disassociate a lion from an image set, or run or view a CV." data-trigger="focus" bs-popover><i class="icon icon-help-with-circle"></i></button>

  <h1><a class="btn btn-default" ng-click="go_back()"><i class="icon icon-arrow-left"></i></a> Search Image Set</h1>
  <div class="row">
    <div class="col-sm-2 line-right">
      <h3 class="text-muted">Refine by</h3>
      <div class="tablist" data-allow-multiple="true" role="tablist" aria-multiselectable="true" bs-collapse>
        <div role="tab">
          <h4>
            <a bs-collapse-toggle ng-click="collapse_name_id()"><i class="pull-right icon icon-select-arrows"></i> Name or ID</a>
          </h4>
        </div>
        <div uib-collapse="isNameIdCollapsed">
          <div class="panel-body">
            <input ng-change="change_name_or_id()" type="text" class="form-control input-sm" ng-model="name_or_id">
          </div>
        </div>
        <div role="tab">
          <h4 >
            <a bs-collapse-toggle ng-click="collapse_organizations()"><i class="pull-right icon icon-select-arrows"></i> Organization</a>
          </h4>
        </div>
        <div uib-collapse="isOrgCollapsed">
          <div class="panel-body checkbox">
            <label ng-repeat="organization in organizations">
              <input ng-click="change_organizations()" type="checkbox"  ng-model="organization.checked" ng-checked="organization.checked">
              <span class="cr"><i class="cr-icon fa fa-check"></i></span>
              {{! organization.name}}
            </label>
          </div>
        </div>
        <div role="tab">
          <h4 >
            <a bs-collapse-toggle ng-click="refreshSlider(); collapse_age()"><i class="pull-right icon icon-select-arrows"></i> Age</a>
          </h4>
        </div>
        <div uib-collapse="isAgeCollapsed">
          <div class="panel-body">
            <rzslider
              rz-slider-model="LionAge.min"
              rz-slider-high="LionAge.max"
              rz-slider-options="LionAge.options"
              rz-slider-step="1"
              rz-slider-on-change="change_age()"
              rz-slider-tpl-url="rzSliderTpl.html">
            </rzslider>
          </div>
        </div>
        <div role="tab">
          <h4 >
            <a bs-collapse-toggle ng-click="collapse_gender()"><i class="pull-right icon icon-select-arrows"></i> Gender</a>
          </h4>
        </div>
        <div uib-collapse="isGenderCollapsed">
          <div class="panel-body checkbox">
            <label ng-repeat="gender in genders">
              <input ng-click="change_gender()" type="checkbox"  ng-model="gender.checked" ng-checked="gender.checked">
              <span class="cr"><i class="cr-icon fa fa-check"></i></span>
              {{! gender.label}}
            </label>
          </div>
        </div>
        <div role="tab" data-placement="auto top" data-trigger="hover" data-animation="am-fade-and-scale" bs-tooltip="tooltip.features">
          <h4>
            <a bs-collapse-toggle ng-click="collapse_features()"><i class="pull-right icon icon-select-arrows"></i>Features</a>
          </h4>
        </div>
        <div uib-collapse="isFeaturesCollapsed">
          <div class="panel-body">
            <input ng-change="change_features()" type="text" class="form-control input-sm" ng-model="tag_features">
          </div>
        </div>
        <div role="tab">
          <h4>
            <a bs-collapse-toggle ng-click="collapse_location()"><i class="pull-right icon icon-select-arrows"></i>Location</a>
          </h4>
        </div>
        <div uib-collapse="isLocationCollapsed">
          <div class="panel-body">
            <form name="form">
              <div class="form-group control" ng-class="{'has-error': form.latitude.$dirty && form.latitude.$error.pattern}">
                <label class="location_label" for="latitude">Latitude: </label>
                <input ng-change="change_location()" class="form-control input-sm" type="text" name="latitude" pattern="^[+-]?[0-9]+([\.|,][0-9]{1,20})?" ng-model="location.latitude" limlatlng="90">
                <div class="error-messages search" ng-messages="form.latitude.$error" ng-if="form.latitude.$error.limlatlng || form.latitude.$error.pattern">
                  <div ng-message="limlatlng">
                    <div class="row">
                      <div class="col-sm-2">
                        <i class="icon icon-error icon-notification"></i>
                      </div>
                      <div class="col-sm-10 error-msg-col">
                        choose a latitude value between -90 and 90.
                      </div>
                    </div>
                  </div>
                  <div ng-message="pattern">
                    <div class="row">
                      <div class="col-sm-2">
                        <i class="icon icon-error icon-notification"></i>
                      </div>
                      <div class="col-sm-10 error-msg-col" ng-if="form.latitude.$error.pattern">
                         this is not a valid latitude.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group control" ng-class="{'has-error': form.longitude.$dirty && form.longitude.$error.pattern}">
                <label class="location_label" for="longitude">Longitude: </label>
                <input ng-change="change_location()" class="form-control input-sm" type="text" name="longitude" pattern="^[+-]?[0-9]+([\.|,][0-9]{1,20})?" ng-model="location.longitude" limlatlng="180">
                <div class="error-messages search" ng-messages="form.longitude.$error" ng-if="form.longitude.$error.limlatlng || form.longitude.$error.pattern">
                  <div ng-message="limlatlng">
                    <div class="row">
                      <div class="col-sm-2">
                        <i class="icon icon-error icon-notification"></i>
                      </div>
                      <div class="col-sm-10 error-msg-col">
                        choose a longitude value between -180 and 180.
                      </div>
                    </div>
                  </div>
                  <div ng-message="pattern">
                    <div class="row">
                      <div class="col-sm-2">
                        <i class="icon icon-error icon-notification"></i>
                      </div>
                      <div class="col-sm-10 error-msg-col" ng-if="form.longitude.$error.pattern">
                         this is not a valid longitude.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group control" ng-class="{'has-error': form.radius.$dirty && form.radius.$error.pattern}">
                <label class="location_label" for="radius">Radius: </label>
                <input ng-change="change_location()" class="form-control input-sm" type="text" name="radius" pattern="^[+-]?[0-9]+([\.|,][0-9]{1,20})?" ng-model="location.radius">
                <div class="error-messages search" ng-messages="form.radius.$error" ng-if="form.radius.$error.pattern">
                  <div ng-message="pattern">
                    <div class="row">
                      <div class="col-sm-2">
                        <i class="icon icon-error icon-notification"></i>
                      </div>
                      <div class="col-sm-10 error-msg-col" ng-if="form.radius.$error.pattern">
                         this is not a valid radius.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-10">
      <div class="row">
        <div class="col-sm-6">
          <h3>{{! viewer_label()}}</h3>
        </div>
        <div class="col-sm-6 text-right form-group">
          <label for="items_page">Lions per page:</label>
          <select class="form-control-inline" id="items_page" name="items_page" ng-options="itemspage.index as itemspage.label for itemspage in PerPages" ng-model="PerPage" ng-change="changeItensPerPage()" >
          </select>
        </div>
      </div>
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="text-center"><a ng-click="order('id')" ng-class="{'order_class': predicate === 'id'}">Id</a>
              <span class="sortorder" ng-show="predicate === 'id'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">Photo</th>
            <th class="text-center">
              <a href="" ng-click="order('name')" ng-class="{'order_class': predicate === 'name'}">Lion Name</a>
              <span class="sortorder" ng-show="predicate === 'name'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">
              <a href="" ng-click="order('lion_id')" ng-class="{'order_class': predicate === 'lion_id'}">Lion Id</a>
              <span class="sortorder" ng-show="predicate === 'lion_id'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">
              <a href="" ng-click="order('age')" ng-class="{'order_class': predicate === 'age'}">Age</a>
              <span class="sortorder" ng-show="predicate === 'age'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">
              <a href="" ng-click="order('is_dead')" ng-class="{'order_class': predicate === 'is_dead'}">Dead</a>
              <span class="sortorder" ng-show="predicate === 'is_dead'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">
              <a href="" ng-click="order('organization')" ng-class="{'order_class': predicate === 'organization'}">Organization</a>
              <span class="sortorder" ng-show="predicate === 'organization'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">
              <a href="" ng-click="order('gender')" ng-class="{'order_class': predicate === 'gender'}">Gender</a>
              <span class="sortorder" ng-show="predicate === 'gender'" ng-class="{reverse:reverse}"></span>
            </th>

            <th class="text-center"><a ng-click="order('latitude')" ng-class="{'order_class': predicate === 'latitude'}">Latitude</a>
              <span class="sortorder" ng-show="predicate === 'latitude'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center"><a ng-click="order('longitude')" ng-class="{'order_class': predicate === 'longitude'}">Longitude</a>
              <span class="sortorder" ng-show="predicate === 'longitude'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center"><a ng-click="order('geopos_private')" ng-class="{'order_class': predicate === 'geopos_private'}">GPS Points<br>Private</a>
              <span class="sortorder" ng-show="predicate === 'geopos_private'" ng-class="{reverse:reverse}"></span>
            </th>

            <th class="text-center"><a ng-click="order('date_stamp')" ng-class="{'order_class': predicate === 'date_stamp'}">Time Stamp</a>
              <span class="sortorder" ng-show="predicate === 'date_stamp'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">
              <a href="" ng-click="order('features')" ng-class="{'order_class': predicate === 'features'}">Features</a>
              <span class="sortorder" ng-show="predicate === 'features'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">
              <a href="" ng-click="order('is_verified')" ng-class="{'order_class': predicate === 'is_verified'}">Verified</a>
              <span class="sortorder" ng-show="predicate === 'is_verified'" ng-class="{reverse:reverse}"></span>
            </th>
            <th class="text-center">
              <a href="" ng-click="order('is_primary')" ng-class="{'order_class': predicate === 'is_primary'}">Primary</a>
              <span class="sortorder" ng-show="predicate === 'is_primary'" ng-class="{reverse:reverse}"></span>
            </th>
            <th colspan="3" class="text-center">
              <a href="" ng-click="order('action')" ng-class="{'order_class': predicate === 'action'}">Actions</a>
              <span class="sortorder" ng-show="predicate === 'action'" ng-class="{reverse:reverse}"></span>
            </th>
            <!-- <th>
              <a href="" ng-click="order('action')" ng-class="{'order_class': predicate === 'action'}">Actions</a>
              <span class="sortorder" ng-show="predicate === 'action'" ng-class="{reverse:reverse}"></span>
            </th> -->
          </tr>
        </thead>
        <tbody>
          <tr class="link" ng-repeat="imageset in paginated_image_set = (filtered_image_sets = (imagesets | orderBy:predicate:reverse | nameid_filter:name_or_id:'lion_id' | age_filter:LionAge | organization_filter:organizations | features_filter:tag_features | gender_filter:genders | LatLngFilter:location:true) | offset:currentPage*itemsPerPage | limitTo: itemsPerPage)">
            <td class="text-center" ui-sref="imageset({id: imageset.id})">{{!imageset.id}}</td>
            <td class="text-center" ui-sref="imageset({id: imageset.id})" ng-right-click="show_photo(imageset.image)">
              <img ng-src="{{!imageset.thumbnail}}" width="40" height="40">
            </td>
            <td class="text-center" ui-sref="imageset({id: imageset.id})">{{!imageset.name}}</td>
            <td class="text-center" ui-sref="imageset({id: imageset.id})">{{!imageset.lion_id}}</td>
            <td ng-if="imageset.age!=null" class="text-center" ui-sref="imageset({id: imageset.id})">{{!imageset.age}} y/o</td>
            <td ng-if="imageset.age==null" class="text-center" ui-sref="imageset({id: imageset.id})"></td>
            <td class="text-center">
              <i ng-if="imageset.dead" class="search-icon-dead"></i>
            </td>
            <td class="text-center" ui-sref="imageset({id: imageset.id})">{{!imageset.organization}}</td>
            <td class="text-center" ui-sref="imageset({id: imageset.id})">{{!imageset.gender}}</td>

            <td ng-if="imageset.permissions.canLocate" class="text-center" ui-sref="imageset({id: imageset.id})">{{!imageset.latitude | number:6}}</td>
            <td ng-if="!imageset.permissions.canLocate" ui-sref="imageset({id: imageset.id})"></td>
            <td ng-if="imageset.permissions.canLocate" class="text-center" ui-sref="imageset({id: imageset.id})">{{!imageset.longitude | number:6}}</td>
            <td ng-if="!imageset.permissions.canLocate" ui-sref="imageset({id: imageset.id})"></td>
            <td class="text-center" ui-sref="imageset({id: imageset.id})">
              <i ng-if="imageset.geopos_private" class="icon icon-check"></i>
              <i ng-if="!imageset.geopos_private" class="icon icon-cross"></i>
            </td>
            <td class="text-center" ui-sref="imageset({id: imageset.id})">
              <div class="div-date_stamp">{{!imageset.date_stamp | date:'yyyy-MM-dd'}}</div>
            </td>
            <!-- Features-->
            <td ng-if="imageset.features" class="text-center">
              <a ui-sref="imageset({id: imageset.id})" data-animation="am-flip-x" placement="top-center" bs-tooltip="imageset.tooltip.features"><i class="icon icon-notification"></i></a>
            </td>
            <td ng-if="!imageset.features" class="text-center" ui-sref="imageset({id: imageset.id})"></td>
            <td class="text-center" ui-sref="imageset({id: imageset.id})">
              <i ng-if="imageset.is_verified" class="icon icon-check"></i>
              <i ng-if="!imageset.is_verified" class="icon icon-cross"></i>
            </td>
            <!-- Is Primary -->
            <td class="text-center">
              <i ng-if="imageset.is_primary" class="icon icon-check"></i>
              <i ng-if="!imageset.is_primary" class="icon icon-cross"></i>
            </td>

            <td ng-if="imageset.permissions.canDisassociate">
              <button class="btn btn-primary btn-sm" 
                data-animation="am-fade-and-slide-top" ng-click="Disassociate(imageset)">
                <i class="icon icon-flash"></i>Disassociate
              </button>
            </td>
            <td ng-if="imageset.permissions.NeedVerify">
              <button ng-if="!imageset.is_verified" class="btn btn-primary btn-sm btn-verify" 
                data-animation="am-fade-and-slide-top" ng-click="Verify(imageset)">
                <i class="icon icon-flash"></i>Verify
              </button>
              <button ng-if="imageset.is_verified" class="btn btn-primary btn-sm" 
                data-animation="am-fade-and-slide-top" ng-click="Disassociate(imageset)">
                <i class="icon icon-flash"></i>Disassociate
              </button>
            </td>

            <td ng-if="imageset.permissions.CanSetPrimary">
              <button class="btn btn-default btn-sm" ng-click="SetPrimary(imageset)"
                data-animation="am-fade-and-slide-top">Set Primary
              </button>
            </td>
            <td ng-if="imageset.permissions.canShow">
              <cvresults use-ctrl="CVResultsCtrl" use-template-url="cvresults.html" form-size="lg" imageset="imageset" cvresults-id="imageset.cvresults" cvrequest-id="imageset.cvrequest" type="search" ng-if="imageset.action == 'cvresults'" cv-result-erased="CVResultsErased(imagesetId)" imageset-updated="UpdateImageset(data, imagesetId)" debug="debug" modal-is-open="is_modal_open"></cvresults>
              <cvrequest use-ctrl="CVRequesCtrl" use-template-url="cvrequest.html" form-size="lg" imageset="imageset" type="search" ng-if="imageset.action == 'cvrequest'" cv-request-success="CVReqSuccess(imageset_Id, request_Obj)" debug="debug" modal-is-open="is_modal_open"></cvrequest>
              <span ng-if="imageset.action == 'cvpending'">
                <i class="icon icon-clock icon-clock-pending"></i><br>
                <span>CV Request pending</span>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
      <nav class="text-center">
        <ul class="pagination pagination-lg">
          <li ng-class="prevPageDisabled()"><a href ng-click="firstPage()">««</a></li>
          <li ng-class="prevPageDisabled()"><a href ng-click="prevPage()">«</a></li>
          <li ng-repeat="n in range()" ng-class="{active: n == currentPage}" ng-click="setPage(n)"><a >{{! n+1}}</a></li>
          <li ng-class="nextPageDisabled()"><a href ng-click="nextPage()">»</a></li>
          <li ng-class="nextPageDisabled()"><a href ng-click="lastPage()">»»</a></li>
        </ul>
      </nav>
    </div>
  </div>
</div>
