<!-- LINC is an open source shared database and facial recognition
system that allows for collaboration in wildlife monitoring.
Copyright (C) 2016  Wildlifeguardians

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

For more information or to contact visit linclion.org or email tech@linclion.org -->
<!-- Tooltip Info Date & Name -->
<script type="text/ng-template" id="tooltip.image.tpl.html">
  <div class="tooltip in tooltip-image font-homenaje" ng-show="title">
    <div class="tooltip-arrow"></div>
    <div class="tooltip-arrow custom-arrow"></div>
    <div class="tooltip-inner" ng-bind-html="title | unsafe"></div>
  </div>
</script>
<div name="ImageGallery" class="font-homenaje">
  <!-- Download Waiting -->
  <div id="download_view" ng-show="download_view" class="downloading-view">
    <h3>Pease wait. Downloading file</h3>
  </div>
  <!-- LightBox -->
  <div id="image_view" ng-show="image_view" class="image-view">
    <uib-carousel active="carousel.active" no-transition="carousel.no_transition" interval="carousel.interval" no-wrap="carousel.noWrapSlides">
      <uib-slide ng-repeat="(index, photo) in paginated_gallery" index="index" class="carousel-pagination">
        <div class="div-image">
          <img ng-src="{{!photo.medium || '//:0' }}" class="carousel-img img-responsive center-block" ng-click="hide_image_view()" ng-dblclick="show_zoom(photo.medium);">
        </div>
        <div class="carousel-caption"> 
          <div class="photo-caption">
            <i class="icon icon-star" ng-if="photo.cover">&nbsp;</i>
            {{!Type_Labels[photo.type]}}
            <i class="icon icon-globe" ng-if="photo.is_public">&nbsp;</i>
            
          </div>
          <div class="photo-controller">
            {{!photo.name}} {{!photo.date | date:'yyyy/MM/dd @ hh:mm'}}
          </div>
        </div>
      </uib-slide>
    </uib-carousel>
  </div>
  <!-- Zoom Panel -->
  <div id="zoom_view" ng-show="zoom_view" class="zoom-view">
    <panzoomwidget panzoom-id="PanZoom" class="panzoom-control"></panzoomwidget>
    <div class="zoom-close">
      <button type="button" class="close pull-right" ng-click="hide_zoom()">&times;</button>
    </div>
    <panzoom id="PanZoom" config="panzoomConfig" model="panzoomModel">
      <img ng-src="{{!panzoomModel.photo || '//:0' }}" class="position-absolute"/>
    </panzoom>
  </div>
  <!-- Gallery Main Page -->
  <div class="modal-header" ng-show="title">
    <button type="button" class="close" ng-click="Close()">&times;</button>
      <h3 class="modal-title" ng-bind-html="title | unsafe"></h3>
    </div>
  <div class="modal-body" ng-show="content">
    <div class="row">
      <div class="row-gallery col-sm-9" ng-cloak>
        <a class="thumbnail" ng-repeat="(index, photo) in paginated_gallery = 
          (filtered_gallery = (gallery | orderBy:Order.by.predicate:Order.by.reverse | PrivateFilter:showPrivated | 
          TypeFilter:FilterSel.Type | CoverFilter:FilterSel.isCover | PropertiesFilter:Properties) | 
          limitTo:itemsPerPage)" 
          ng-class="{active:photo.select}" 
          ng-click="show_image_view(photo, index);" 
          ng-right-click="show_photo(photo.medium)">
          <i class="icon icon-check_circle select" ng-click="photo.select=!photo.select; Select_Image($event, photo, index); $event.stopPropagation();"></i>
          <img ng-src="{{!photo.thumbnail}}" width="157" height="157" 
            data-animation="am-flip-x" data-html="true" data-template-url='tooltip.image.tpl.html'
            placement="bottom" bs-tooltip="photo.tooltip">
          <div class="caption"><i class="icon icon-globe pull-right" ng-if="photo.is_public"></i><i class="icon icon-star" ng-if="photo.cover"></i>{{!Type_Labels[photo.type]}}</div>
        </a>
        <p class="clearfix">
          <a class="btn btn-link" ng-click="Select_All()">Select All</a>
          <a class="btn btn-link" ng-click="UnSelect_All()">Select None</a>
        </p>
        <p ng-show="itemsPerPage!=gallery.length" class="text-center">
          <a ng-click="increase_pages();" class="btn btn-link">
            {{!itemsPerPage}} of {{!filtered_gallery.length}} results returned. Load more?
          <b class="caret"></b></a>
        </p>
        <p ng-show="itemsPerPage==gallery.length" disabled class="text-center"><a class="btn btn-link">
          {{!itemsPerPage}} of {{!filtered_gallery.length}} results.</a>
        </p>
      </div>
      <div class="col-sm-3 line-left">
        <div class="form-group gallery-order"> 
          <label class="control-label">Order by:</label>
          <ui-select ng-model="Order.by" theme="bootstrap">
            <ui-select-match placeholder="Select ...">
              <div ng-bind-html="$select.selected.label | highlight: $select.search"></div>
            </ui-select-match>
            <ui-select-choices repeat="item in ListOfOrderBy | filter: $select.search">
              <div ng-bind-html="item.label | highlight: $select.search"></div>
            </ui-select-choices>
          </ui-select>
        </div>
        <ul class="nav nav-tabs tabs-sm" ng-hide="!showPrivated">
          <li role="presentation" ng-class="{active:isViewFilter}"><a ng-click="Change_Tab('filter')">Filter</a></li>
          <li role="presentation" class="tabs-primary" ng-class="{active:!isViewFilter}"><a ng-click="Change_Tab('edit')">Edit</a></li>
        </ul>
        <div ng-show="isViewFilter" class="gallery-filter">
          <h4>Image type</h4>
          <div class="radio" ng-init="FilterSel.Type='all'" ng-repeat="item in Filters">
            <label><input type="radio" ng-model="FilterSel.Type" ng-value="item.type" ng-click="UnSelect_All();calc_itemspage();">{{!item.label}}</label>
          </div>
          <h4>Properties</h4>
          <div class="checkbox" ng-repeat="(key, property)  in Properties">
            <label><input type="checkbox" checked ng-model="property.checked" ng-click="UnSelect_All();calc_itemspage()">{{! property.name}}</label>
          </div>
          <div class="checkbox">
            <label><input type="checkbox" ng-model="FilterSel.isCover" ng-click="UnSelect_All();calc_itemspage()"> Cover image</label>
          </div>
        </div>

        <div ng-hide="isViewFilter || !showPrivated" class="gallery-edit">
          <h4>Image type</h4>
          <div class="radio" ng-init="Selected.Type='all'" ng-repeat="item in Selects">
            <label><input type="radio" ng-model="Selected.Type" ng-value="item.type" ng-click="Change_Type()" ng-disabled="!Selecteds.length">{{!item.label}}</label>
          </div>
          <h4>Properties</h4>
          <div class="form-group">
            <select class="form-control custom-select" ng-change="Change_isPublic();" ng-options="property.value as property.name for property in Properties" ng-model="Selected.isPublic" required ng-disabled="!Selecteds.length">
              <option></option>
            </select>
          </div>
          <!--
          <div class="checkbox">
            <label><input ng-click="Change_isPublic();" type="checkbox" checked ng-model="Selected.isPublic" >Public</label>
          </div>-->
          <div class="checkbox">
            <label><input ng-click="Change_Cover()" ng-disabled="!Selected.isPublic || Selecteds.length!=1" type="checkbox" ng-model="Selected.isCover">Cover image</label>
          </div>
        </div>
        <p>
          <button ng-disabled="!Selecteds.length" class="btn btn-default btn-block btn-img-gallery" ng-click="Delete()">Delete</button>
          <button ng-disabled="!Selecteds.length" class="btn btn-default btn-block btn-img-gallery" ng-click="Download()">Download original</button>
          <upload-images use-ctrl="UploadImagesCtrl" use-template-url="uploadimages.html" form-size="lg" type="edit" imageset-id="imagesetId" image-updated="UpdateImages()" debug="debug"></upload-images>
        </p>
      </div>
    </div>
  </div>
</div>